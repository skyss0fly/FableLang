using System.Reflection;

void LoadLibrary(string dllPath)
{
    var assembly = Assembly.LoadFrom(dllPath);
    var mathType = assembly.GetType("FabMath.MathLibrary");
    var methods = mathType.GetMethods(BindingFlags.Public | BindingFlags.Static);

    var mathDict = new Dictionary<string, Func<double[], double>>();
    foreach(var method in methods)
    {
        mathDict[method.Name.ToLower()] = (args) =>
        {
            var result = method.Invoke(null, args.Cast<object>().ToArray());
            return Convert.ToDouble(result);
        };
    }

    // Store mathDict in interpreter environment as "math"
    Environment["math"] = mathDict;
}



C:\FabLang>dotnet add Fablang.csproj reference FabMath/FabMath.csproj
Reference `FabMath\FabMath.csproj` added to the project.

C:\FabLang>dotnet run -- test.fab
C:\FabLang\obj\Debug\net8.0\.NETCoreApp,Version=v8.0.AssemblyAttributes.cs(4,12): error CS0579: Duplicate 'global::Syst
em.Runtime.Versioning.TargetFrameworkAttribute' attribute [C:\FabLang\FabLang.csproj]
C:\FabLang\obj\Debug\net8.0\FabLang.AssemblyInfo.cs(13,12): error CS0579: Duplicate 'System.Reflection.AssemblyCompanyA
ttribute' attribute [C:\FabLang\FabLang.csproj]
C:\FabLang\obj\Debug\net8.0\FabLang.AssemblyInfo.cs(14,12): error CS0579: Duplicate 'System.Reflection.AssemblyConfigur
ationAttribute' attribute [C:\FabLang\FabLang.csproj]
C:\FabLang\obj\Debug\net8.0\FabLang.AssemblyInfo.cs(15,12): error CS0579: Duplicate 'System.Reflection.AssemblyFileVers
ionAttribute' attribute [C:\FabLang\FabLang.csproj]
C:\FabLang\obj\Debug\net8.0\FabLang.AssemblyInfo.cs(16,12): error CS0579: Duplicate 'System.Reflection.AssemblyInformat
ionalVersionAttribute' attribute [C:\FabLang\FabLang.csproj]
C:\FabLang\obj\Debug\net8.0\FabLang.AssemblyInfo.cs(17,12): error CS0579: Duplicate 'System.Reflection.AssemblyProductA
ttribute' attribute [C:\FabLang\FabLang.csproj]
C:\FabLang\obj\Debug\net8.0\FabLang.AssemblyInfo.cs(18,12): error CS0579: Duplicate 'System.Reflection.AssemblyTitleAtt
ribute' attribute [C:\FabLang\FabLang.csproj]
C:\FabLang\obj\Debug\net8.0\FabLang.AssemblyInfo.cs(19,12): error CS0579: Duplicate 'System.Reflection.AssemblyVersionA
ttribute' attribute [C:\FabLang\FabLang.csproj]

The build failed. Fix the build errors and run again.

C:\FabLang>
